

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Client side websockets API &mdash; Rain 0.30.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.30.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Rain 0.30.0 documentation" href="../index.html" />
    <link rel="next" title="Client rendering" href="client_rendering.html" />
    <link rel="prev" title="Client runtime dependencies" href="requirejs.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="client_rendering.html" title="Client rendering"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="requirejs.html" title="Client runtime dependencies"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Rain 0.30.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="client-side-websockets-api">
<h1>Client side websockets API<a class="headerlink" href="#client-side-websockets-api" title="Permalink to this headline">¶</a></h1>
<p>In RAIN you can easily access websockets that are defined in RAIN components. As described
in page <a class="reference internal" href="../server/websockets.html"><em>RAIN Websockets</em></a>, websockets in RAIN have a well defined model and are
auto discovered for each component. During autodiscovery process the web sockets handlers
receive a channel and they are registered at a certain url.</p>
<p>On the client side, to be able to connect to a websocket you need to specify the channel. In
RAIN the client runtime provides easy access to websockets.</p>
<p>Below you can find a simple example of how to obtain a websocket connection for this case:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">_socket</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">messaging</span><span class="p">.</span><span class="nx">getSocket</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span>
</pre></div>
</div>
<p>After you obtain a connection to this websocket you can easily start to emit messages and
react to messages. The obtained socket is obtained from socket.io. For more information
about socket io visit: <a class="reference external" href="http://socket.io/">http://socket.io/</a>.</p>
<div class="section" id="websockets-example">
<h2>Websockets example<a class="headerlink" href="#websockets-example" title="Permalink to this headline">¶</a></h2>
<p>In the components folder you can find a simple example of how to send and receive messages.
Below you can find a function client controller example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">function</span> <span class="nx">Controller</span><span class="p">()</span> <span class="p">{}</span>

    <span class="nx">Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_socket</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">messaging</span><span class="p">.</span><span class="nx">getSocket</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">configureSocket</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
    <span class="p">};</span>

    <span class="nx">Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">getRoot</span><span class="p">(),</span>
            <span class="nx">btnTalk</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[data-itemid=&#39;btnCustomHandler&#39;]&quot;</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="nx">btnTalk</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">_socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;new-message&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;Welcome!&#39;</span><span class="p">});</span>
        <span class="p">});</span>
    <span class="p">};</span>

    <span class="cm">/**</span>
<span class="cm">     * Method used to communicate with the chat server side handler.</span>
<span class="cm">     */</span>
    <span class="nx">Controller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">configureSocket</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">Controller</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The above example does the following:</p>
<blockquote>
<div><ul class="simple">
<li>Send a welcome message through the websocket.</li>
<li>Display de message data received for <em>hello</em> message.</li>
</ul>
</div></blockquote>
<p>RAIN websockets provide a module of idle time disconnect. If a client is innactive for a preset time
and the number of admitted websocket connections on the server is reached than the idle websockets
are disconnect. If the client tries to emit any type of event over it&#8217;s websocket channel than
the connection is reestablished.</p>
</div>
<div class="section" id="cookie-expiration">
<h2>Cookie Expiration<a class="headerlink" href="#cookie-expiration" title="Permalink to this headline">¶</a></h2>
<p>When the communication with the server is happening only via Web Sockets, no headers are exchanged
and the cookie expiration time is never extended. To overcome this limitation, Web Socket
activity is monitored and when the cookie is about to expire, an AJAX call is sent to the server
if any message was sent or received. If no activity occurred, a <tt class="docutils literal"><span class="pre">session_expired</span></tt> event
is published globally to notify the application that the session for the current user expired.
One possible way to respond to this event is to redirect the user to the login page. The
following example shows how you can listen for this event:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">messaging</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;session_expired&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Expired Session&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Client side websockets API</a><ul>
<li><a class="reference internal" href="#websockets-example">Websockets example</a></li>
<li><a class="reference internal" href="#cookie-expiration">Cookie Expiration</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="requirejs.html"
                        title="previous chapter">Client runtime dependencies</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="client_rendering.html"
                        title="next chapter">Client rendering</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="client_rendering.html" title="Client rendering"
             >next</a> |</li>
        <li class="right" >
          <a href="requirejs.html" title="Client runtime dependencies"
             >previous</a> |</li>
        <li><a href="../index.html">Rain 0.30.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>