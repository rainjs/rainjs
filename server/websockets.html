

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>RAIN Websockets &mdash; Rain v0.24.0 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.24.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Rain v0.24.0 documentation" href="../index.html" />
    <link rel="next" title="RAIN component descriptor" href="component_descriptor.html" />
    <link rel="prev" title="Intents" href="messaging_intents.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="component_descriptor.html" title="RAIN component descriptor"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="messaging_intents.html" title="Intents"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Rain v0.24.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="rain-websockets">
<h1>RAIN Websockets<a class="headerlink" href="#rain-websockets" title="Permalink to this headline">¶</a></h1>
<p>RAIN aims to make new HTML5 specification accessible to user and also to provide graceful
degradation where necessary. Websockets are one of the coolest addition of HTML 5 and opens
a new perspective in web development.</p>
<div class="section" id="rain-websockets-interface">
<h2>RAIN Websockets Interface<a class="headerlink" href="#rain-websockets-interface" title="Permalink to this headline">¶</a></h2>
<p>In RAIN is really easy to use websockets. You don&#8217;t even have to care about browser compatibility
because this is automatically provided by socket.io (the underlining framework used for websockets).</p>
<p>Each websocket you define must provide a handle method:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Hello Sockets!&#39;</span><span class="p">});</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In RAIN websockets are auto-discovered for each registered component. All you have to do is place
your socket handlers under the <tt class="docutils literal"><span class="pre">websockets</span></tt> folder of your component root.</p>
<p>Lets take a really simple example from the chat component:</p>
<div class="highlight-js"><pre>/chat
    /server
        /websockets
            /chat.js
    /client</pre>
</div>
<p>And now the chat handler code:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Hello Sockets!&#39;</span><span class="p">});</span>

    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;new-message&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">text</span><span class="p">);</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">channel</span><span class="o">:</span> <span class="s1">&#39;chat&#39;</span><span class="p">,</span>
    <span class="nx">handle</span><span class="o">:</span> <span class="nx">handle</span>
<span class="p">};</span>
</pre></div>
</div>
<p>At registration time, RAIN will map the socket handler automatically. To see how to use the sockets
on the client side see: <a class="reference internal" href="../client/websockets.html"><em>Client side websockets API</em></a>.</p>
<p>This module will send and receive messages on the <tt class="docutils literal"><span class="pre">chat</span></tt> channel. Multiple components can
safely use the same channel name because the channel name is also prefixed with the component
id and version.</p>
<p>The session is exposed using the <tt class="docutils literal"><span class="pre">session</span></tt> property of the socket object both in the handle
method and in each event listener. The session is automatically saved after you code executes.
You can delay the session save by returning a promise and resolving it after you set the needed
data on the session:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">defer</span><span class="p">();</span>

        <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">socket</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">RAIN Websockets</a><ul>
<li><a class="reference internal" href="#rain-websockets-interface">RAIN Websockets Interface</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="messaging_intents.html"
                        title="previous chapter">Intents</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="component_descriptor.html"
                        title="next chapter">RAIN component descriptor</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="component_descriptor.html" title="RAIN component descriptor"
             >next</a> |</li>
        <li class="right" >
          <a href="messaging_intents.html" title="Intents"
             >previous</a> |</li>
        <li><a href="../index.html">Rain v0.24.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.1.
    </div>
  </body>
</html>