

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Class Monitoring &mdash; Rain v0.29.0 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.29.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Rain v0.29.0 documentation" href="../../index.html" />
    <link rel="next" title="Class MonitoringAdapter" href="MonitoringAdapter.html" />
    <link rel="prev" title="Class ModuleLoader" href="ModuleLoader.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="MonitoringAdapter.html" title="Class MonitoringAdapter"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ModuleLoader.html" title="Class ModuleLoader"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Rain v0.29.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="class-monitoring">
<h1>Class Monitoring<a class="headerlink" href="#class-monitoring" title="Permalink to this headline">¶</a></h1>
<p>Monitoring module. Populates a measurement map depending on useCases, if the useCases are disabled
than they are not added to the measurement map. The monitoring module will not work / will be disabled
in the following situation:
- the monitoring configuration is missing;
- the adapter module instance is missing or could not be initialized;
- the monitoring metrics key is missing;
- the disabled key in the monitoring configuration;</p>
<p>The monitoring module can also measure some use cases for different tlds. In this sittuation please
use.</p>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">monitoringInstance</span> <span class="o">=</span> <span class="nx">Monitoring</span><span class="p">.</span><span class="nx">get</span><span class="p">();</span>
 <span class="kd">var</span> <span class="nx">useCase</span> <span class="o">=</span> <span class="nx">monitoringInstance</span><span class="p">.</span><span class="nx">registerTld</span><span class="p">(</span><span class="s1">&#39;&lt;useCase&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;host&gt;&#39;</span><span class="p">);</span>
 <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">monitoringInstance</span><span class="p">.</span><span class="nx">startMeasurement</span><span class="p">(</span><span class="nx">useCase</span><span class="p">);</span>
 <span class="nx">monitoringInstance</span><span class="p">.</span><span class="nx">endMeasurement</span><span class="p">(</span><span class="nx">useCase</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
 <span class="nx">monitoringInstance</span><span class="p">.</span><span class="nx">registerEvent</span><span class="p">(</span><span class="nx">useCase</span><span class="p">);</span>
</pre></div>
</div>
<p>The monitoring module can also load self dependent measurement plugins with their own measurement
plan and logic. To include your modules you should describe them in your configuration like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="s2">&quot;measurementPlugins&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;pluginName&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;./path/to/plugin&quot;</span>
      <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Also you should not forget to include the <tt class="docutils literal"><span class="pre">pluginName</span></tt> set above in your <tt class="docutils literal"><span class="pre">metrics</span></tt> key
from the configuration file. The way you write it in the metrics key is the same as for other
use cases.</p>
<p>The monitoring module creates a measurementMap that would look like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="s2">&quot;useCase1&quot;</span><span class="o">:</span> <span class="p">{</span>
     <span class="nx">key</span><span class="o">:</span><span class="s1">&#39;zabbixUniqueKey&#39;</span><span class="p">,</span>
     <span class="nx">operation</span><span class="o">:</span> <span class="s1">&#39;count&#39;</span><span class="o">/</span><span class="s1">&#39;average&#39;</span><span class="p">,</span>
     <span class="nx">secondaryKey</span><span class="o">:</span> <span class="s1">&#39;secondaryZabbixKey&#39;</span><span class="p">,</span>
     <span class="nx">step</span><span class="o">:</span> <span class="p">{</span><span class="nb">Number</span><span class="p">}</span>
     <span class="nx">measurements</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">activeRequests</span><span class="o">:</span> <span class="p">{</span><span class="nb">Number</span><span class="p">},</span>
         <span class="nx">resolvedRequests</span><span class="o">:</span> <span class="p">{</span><span class="nb">Number</span><span class="p">},</span>
         <span class="nx">total</span><span class="o">:</span> <span class="p">{</span><span class="nb">Number</span><span class="p">},</span>
         <span class="nx">registered</span><span class="o">:</span> <span class="p">{</span><span class="nb">Boolean</span><span class="p">},</span>
         <span class="nx">start</span><span class="o">:</span> <span class="p">{</span><span class="nx">Time</span><span class="p">},</span>
         <span class="nx">end</span><span class="o">:</span> <span class="p">{</span><span class="nx">Time</span><span class="p">},</span>
         <span class="nx">uniqueId1</span><span class="o">:</span> <span class="p">{</span>
             <span class="nx">time</span><span class="o">:</span> <span class="p">{</span><span class="nb">Number</span><span class="p">},</span>
             <span class="nx">end</span><span class="o">:</span> <span class="p">{</span><span class="nb">Boolean</span><span class="p">},</span>
          <span class="p">}</span>
          <span class="nx">uniqueId2</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">time</span><span class="o">:</span> <span class="p">{</span><span class="nb">Number</span><span class="p">},</span>
              <span class="nx">end</span><span class="o">:</span> <span class="p">{</span><span class="nb">Boolean</span><span class="p">},</span>
          <span class="p">}</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<p><strong>key</strong> - Mandatory. The unique zabbix server key.
<strong>operation</strong> - Mandatory. The operation to be done on a specific use case. Posibilities are: <tt class="docutils literal"><span class="pre">count</span></tt> and
<tt class="docutils literal"><span class="pre">average</span></tt>
<strong>secondaryKey</strong> - Optional. Only present if the operation set for the use case is <tt class="docutils literal"><span class="pre">average</span></tt>. Otherwise
it will not be taken into consideration.
<strong>step</strong> - Optional. If present it will over write the interval of sending for the use case it is set. If
not present the interval is the global one.
<strong>measurements</strong> - Generated object on the first <tt class="docutils literal"><span class="pre">startMeasurement</span></tt> or <tt class="docutils literal"><span class="pre">registerEvent</span></tt> method call.
<strong>activeRequests</strong> - Generated on the first <tt class="docutils literal"><span class="pre">startMeasurement</span></tt> or <tt class="docutils literal"><span class="pre">registerEvent</span></tt> method call.
Incremented on <tt class="docutils literal"><span class="pre">startMeasurement</span></tt> or <tt class="docutils literal"><span class="pre">registerEvent</span></tt> call and decremented on <tt class="docutils literal"><span class="pre">endMeasurement</span></tt> call.
This key is reset only for registered events.
<strong>resolvedRequests</strong> - Generated on the first <tt class="docutils literal"><span class="pre">startMeasurement</span></tt> method call. Incremented on
<tt class="docutils literal"><span class="pre">endMeasurement</span></tt> call. The value is reset after every successfull send.
<strong>total</strong> - Generated on the first <tt class="docutils literal"><span class="pre">startMeasurement</span></tt> method call only for the use cases with the
operation <tt class="docutils literal"><span class="pre">average</span></tt>. It represents the total time spent for resolving requests in a period time.
<strong>registered</strong> - Generated on the first <tt class="docutils literal"><span class="pre">registerEvent</span></tt> method call. It signals that the current
measurement is special and it has been registered not traditional <tt class="docutils literal"><span class="pre">startMeasurement</span></tt>, <tt class="docutils literal"><span class="pre">endMeasurement</span></tt>
process. Flag is used in the logic of the data reset.
<strong>start</strong> - Generated at every <tt class="docutils literal"><span class="pre">startMeasurement</span></tt>, represents the time when the measurement was last started.
Needed for the logic of sending data. If no <tt class="docutils literal"><span class="pre">startMeasurement</span></tt> has been executed in that interval of time
than data for that use case will not be sent.
<strong>end</strong> - Generated at every <tt class="docutils literal"><span class="pre">endMeasurement</span></tt>, represents the time when the measurement was last ended.
Needed for the logic of sending data. If no <tt class="docutils literal"><span class="pre">endMeasurement</span></tt> has been executed in that interval of time
than data for that use case will not be sent.
<strong>uniqueId**1,2 - Set only for the usecases that have ``average`` operation set at the first ``startMeasurement``
method call. This id will be passed or will be automatically generated internaly using crypto. U should always
use an unique id. The id is not reusable, you can only end a measurement for a specific id, after that it
will be deleted.
**time</strong> - Set only for unique Ids in use cases with <tt class="docutils literal"><span class="pre">average</span></tt> operation. Represents the time when
the <tt class="docutils literal"><span class="pre">startMeasurement</span></tt> was called for that specific id. Needed to calculate the time of a resolved
request.
<strong>end</strong> - Set only for unique Ids in use cases with <tt class="docutils literal"><span class="pre">average</span></tt> operation. Flags the id that it can
be deleted when <tt class="docutils literal"><span class="pre">resetData</span></tt> is called.</p>
</div>
<div class="section" id="constructor">
<h2>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="Monitoring">
<em class="property">class </em><tt class="descname">Monitoring</tt><big>(</big><big>)</big><a class="headerlink" href="#Monitoring" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">Throws RainError:</th></tr>
<tr><td>&nbsp;</td><td class="field-body">: if any use case misses the mandatory zabbix key or the operation.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<div class="section" id="close">
<h3>close<a class="headerlink" href="#close" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="Monitoring#close">
<tt class="descname">Monitoring#close</tt><big>(</big><big>)</big><a class="headerlink" href="#Monitoring#close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">Returns Promise:</th></tr>
<tr><td>&nbsp;</td><td class="field-body">when all ongoing writes to zabbix server are finished.</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Writes all the collected data to the Monitoring Server. No more monitoring can be done
after calling this method.</p>
</div>
<div class="section" id="endmeasurement">
<h3>endMeasurement<a class="headerlink" href="#endmeasurement" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="Monitoring#endMeasurement">
<tt class="descname">Monitoring#endMeasurement</tt><big>(</big><em>configKey</em><span class="optional">[</span>, <em>id</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Monitoring#endMeasurement" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>configKey</strong> (<em>String</em>) &#8211; the name of the use case.</li>
<li><strong>id</strong> (<em>String</em>) &#8211; the unique measurement id.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>End of measurement for a specific use case. Logs errors if the use case key is missing, the specified
use case is not present in the metrics configuration, the specified id is not present in the measurement
map or there was no measurement started before the <tt class="docutils literal"><span class="pre">endMeasurement</span></tt> was called.</p>
</div>
<div class="section" id="get">
<h3>get<a class="headerlink" href="#get" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="Monitoring.get">
<tt class="descclassname">Monitoring.</tt><tt class="descname">get</tt><big>(</big><big>)</big><a class="headerlink" href="#Monitoring.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">Returns Monitoring:</th></tr>
<tr><td>&nbsp;</td><td class="field-body">instance of the Monitoring class.</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Singleton getter.</p>
</div>
<div class="section" id="registerevent">
<h3>registerEvent<a class="headerlink" href="#registerevent" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="Monitoring#registerEvent">
<tt class="descname">Monitoring#registerEvent</tt><big>(</big><em>configKey</em>, <em>value</em><big>)</big><a class="headerlink" href="#Monitoring#registerEvent" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>configKey</strong> (<em>String</em>) &#8211; useCase for which to gather data.</li>
<li><strong>value</strong> &#8211; </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Collecting other types of monitoring data not depending on <tt class="docutils literal"><span class="pre">startMeasurement</span></tt> and <tt class="docutils literal"><span class="pre">endMeasurement</span></tt>
methods, this method can be called only for the use cases that have a <tt class="docutils literal"><span class="pre">count</span></tt> operation.</p>
</div>
<div class="section" id="registertld">
<h3>registerTld<a class="headerlink" href="#registertld" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="Monitoring#registerTld">
<tt class="descname">Monitoring#registerTld</tt><big>(</big><em>configKey</em><span class="optional">[</span>, <em>host</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Monitoring#registerTld" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>configKey</strong> (<em>String</em>) &#8211; the name of the use case.</li>
<li><strong>host</strong> (<em>String</em>) &#8211; optional parameter representing the host that requests the measurement.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Returns String/Null:</th></tr>
<tr><td>&nbsp;</td><td class="field-body"><p class="first last">returns the name of the use case or null if the module is disabled.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Registers a tld use case if no host is passed then it will return the current useCase, also
if the tld configuration is disabled it will also return the same useCase. If the module
is disabled then this method will not work. This module also dynamically adds a clone of the base
use case concatanated with the tld retrieved from the host paramether.</p>
</div>
<div class="section" id="startmeasurement">
<h3>startMeasurement<a class="headerlink" href="#startmeasurement" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="Monitoring#startMeasurement">
<tt class="descname">Monitoring#startMeasurement</tt><big>(</big><em>configKey</em><span class="optional">[</span>, <em>id</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Monitoring#startMeasurement" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>configKey</strong> (<em>String</em>) &#8211; the name of the use case.</li>
<li><strong>id</strong> (<em>String</em>) &#8211; the unique measurement id.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns String:</th><td class="field-body"><p class="first last">id the unique measurement id.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Start of the measurement for a specific useCase with an unique id. Logs errors if the use case
is missing or the specified useCase is not present in the metrics configuration. If no measurement
was started before for an use case it registers a measurement key in the measurement map. Please
see the class documentation for the parameters set by this method.</p>
</div>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="measurementplugins">
<h3>measurementPlugins<a class="headerlink" href="#measurementplugins" title="Permalink to this headline">¶</a></h3>
<dl class="attribute">
<dt id="measurementPlugins ">
<tt class="descname">measurementPlugins </tt><a class="headerlink" href="#measurementPlugins " title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>delay registering plugins, mess up multiple requires.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Class Monitoring</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#constructor">Constructor</a></li>
<li><a class="reference internal" href="#methods">Methods</a><ul>
<li><a class="reference internal" href="#close">close</a></li>
<li><a class="reference internal" href="#endmeasurement">endMeasurement</a></li>
<li><a class="reference internal" href="#get">get</a></li>
<li><a class="reference internal" href="#registerevent">registerEvent</a></li>
<li><a class="reference internal" href="#registertld">registerTld</a></li>
<li><a class="reference internal" href="#startmeasurement">startMeasurement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attributes">Attributes</a><ul>
<li><a class="reference internal" href="#measurementplugins">measurementPlugins</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ModuleLoader.html"
                        title="previous chapter">Class ModuleLoader</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="MonitoringAdapter.html"
                        title="next chapter">Class MonitoringAdapter</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="MonitoringAdapter.html" title="Class MonitoringAdapter"
             >next</a> |</li>
        <li class="right" >
          <a href="ModuleLoader.html" title="Class ModuleLoader"
             >previous</a> |</li>
        <li><a href="../../index.html">Rain v0.29.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>